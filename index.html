<!DOCTYPE html>
<html>
  <head>
    <title>MQTT Login</title>
    <!-- âœ… LOAD PAHO LIBRARY CORRECTLY -->
    <script src="https://unpkg.com/paho-mqtt@1.1.0/paho-mqtt-min.js"></script>
  </head>
  <body>
    <h2>MQTT Login</h2>

    <div id="login">
      <input type="text" id="username" placeholder="MQTT Username" /><br /><br />
      <input type="password" id="password" placeholder="MQTT Password" /><br /><br />
      <button onclick="connectMQTT()">Login & Connect</button>
    </div>

    <div id="dashboard" style="display: none">
      <h3>Connected to MQTT!</h3>
      <p id="mqttStatus">Waiting for messages...</p>
    </div>

    <script>
      const broker = "1b56fa9f5384446881ab36a7be8959fb.s1.eu.hivemq.cloud"; // Replace this

      function connectMQTT() {
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;
        const clientID = "web_" + Math.random().toString(16).substr(2, 8);

        const client = new Paho.Client(broker, clientID);

        client.onConnectionLost = function (responseObject) {
          console.log("Connection lost:", responseObject.errorMessage);
        };

        client.onMessageArrived = function (message) {
          document.getElementById("mqttStatus").innerText =
            "Message: " + message.payloadString;
        };

        client.connect({
          useSSL: true,
          userName: username,
          password: password,
          onSuccess: () => {
            console.log("Connected!");
            document.getElementById("login").style.display = "none";
            document.getElementById("dashboard").style.display = "block";
            client.subscribe("vfd/hello");
          },
          onFailure: (err) => {
            alert("Failed to connect: " + err.errorMessage);
          },
        });
      }
    </script>
  </body>
</html>
