<script>
  const broker = "wss://1b56fa9f5384446881ab36a7be8959fb.s1.eu.hivemq.cloud:8884/mqtt"; // Your broker
  let client; // define it globally so we can use it later

  function connectMQTT() {
    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;
    const clientID = "web_" + Math.random().toString(16).substr(2, 8);

    client = new Paho.Client(broker, clientID);

    client.onConnectionLost = function (responseObject) {
      console.log("Connection lost:", responseObject.errorMessage);
    };

    client.onMessageArrived = function (message) {
      console.log("Message received:", message.payloadString);
      document.getElementById("mqttStatus").innerText = "Message: " + message.payloadString;
    };

    client.connect({
      useSSL: true,
      userName: username,
      password: password,
      onSuccess: () => {
        console.log("Connected!");
        document.getElementById("login").style.display = "none";
        document.getElementById("dashboard").style.display = "block";

        // ✅ SUBSCRIBE to a topic
        client.subscribe("vfd/hello");

        // ✅ SEND a message to another topic
        const msg = new Paho.Message("Login successful!");
        msg.destinationName = "vfd/status";
        client.send(msg);
      },
      onFailure: (err) => {
        alert("Failed to connect: " + err.errorMessage);
      },
    });
  }
</script>
